{
  "title": "Tower Unified – SiteBoss + Simulator (Clean)",
  "uid": "tower-unified",
  "timezone": "browser",
  "schemaVersion": 39,
  "version": 2,
  "editable": true,
  "fiscalYearStartMonth": 1,
  "time": {"from": "now-6h", "to": "now"},
  "templating": {
    "list": [
      {
        "type": "query",
        "name": "towerId",
        "label": "Tower",
        "datasource": null,
        "query": "label_values({__name__=~\"telemetry_ingest_saved_total|siteboss_sensor_count\"}, towerId)",
        "refresh": 1,
        "includeAll": true,
        "allValue": ".*",
        "multi": false
      }
    ]
  },
  "panels": [
    {"type":"row","title":"Overview","gridPos":{"x":0,"y":0,"w":24,"h":1}},

    {"type":"stat","title":"Battery","gridPos":{"x":0,"y":1,"w":6,"h":4},"datasource":null,
      "options":{"reduceOptions":{"calcs":["lastNotNull"],"fields":""},"graphMode":"area","colorMode":"value","textMode":"auto","sparkline":{"show":true}},
      "fieldConfig":{"defaults":{"unit":"percent","decimals":0,"thresholds":{"mode":"absolute","steps":[{"color":"red","value":0},{"color":"yellow","value":50},{"color":"green","value":80}]}}},
      "targets":[{"expr":"simulator_metric_value{towerId=~\"$towerId\", name=\"battery\"}"}]},

    {"type":"stat","title":"Temperature","gridPos":{"x":6,"y":1,"w":6,"h":4},"datasource":null,
      "options":{"reduceOptions":{"calcs":["lastNotNull"],"fields":""},"graphMode":"area","colorMode":"value","sparkline":{"show":true}},
      "fieldConfig":{"defaults":{"unit":"celsius","decimals":1,"thresholds":{"mode":"absolute","steps":[{"color":"blue","value":-50},{"color":"green","value":15},{"color":"yellow","value":30},{"color":"red","value":40}]}}},
      "targets":[{"expr":"simulator_metric_value{towerId=~\"$towerId\", name=\"temperature\"}"}]},

    {"type":"stat","title":"Network Load","gridPos":{"x":12,"y":1,"w":6,"h":4},"datasource":null,
      "options":{"reduceOptions":{"calcs":["lastNotNull"],"fields":""},"graphMode":"area","colorMode":"value","sparkline":{"show":true}},
      "fieldConfig":{"defaults":{"unit":"percent","decimals":1,"thresholds":{"mode":"absolute","steps":[{"color":"green","value":0},{"color":"yellow","value":60},{"color":"red","value":85}]}}},
      "targets":[{"expr":"simulator_metric_value{towerId=~\"$towerId\", name=\"network_load\"}"}]},

    {"type":"stat","title":"Uptime","gridPos":{"x":18,"y":1,"w":6,"h":4},"datasource":null,
      "options":{"reduceOptions":{"calcs":["lastNotNull"],"fields":""},"graphMode":"area","colorMode":"value","sparkline":{"show":true}},
      "fieldConfig":{"defaults":{"unit":"percent","decimals":0,"thresholds":{"mode":"absolute","steps":[{"color":"red","value":0},{"color":"green","value":99}]}}},
      "targets":[{"expr":"simulator_metric_value{towerId=~\"$towerId\", name=\"uptime\"}"}]},

    {"type":"stat","title":"SiteBoss Sensors","gridPos":{"x":0,"y":5,"w":6,"h":4},"datasource":null,
      "options":{"reduceOptions":{"calcs":["lastNotNull"],"fields":""},"graphMode":"none","colorMode":"value"},
      "fieldConfig":{"defaults":{"unit":"none"}},
      "targets":[{"expr":"sum(siteboss_sensor_count{towerId=~\"$towerId\"})"}]},

    {"type":"stat","title":"Alerts – Critical","gridPos":{"x":6,"y":5,"w":6,"h":4},"datasource":null,
      "options":{"reduceOptions":{"calcs":["lastNotNull"],"fields":""},"graphMode":"none","colorMode":"value"},
      "fieldConfig":{"defaults":{"unit":"none","thresholds":{"mode":"absolute","steps":[{"color":"green","value":0},{"color":"red","value":1}]}}},
      "targets":[{"expr":"sum(siteboss_alert_count{towerId=~\"$towerId\", level=\"critical\"})"}]},

    {"type":"stat","title":"Alerts – Warning","gridPos":{"x":12,"y":5,"w":6,"h":4},"datasource":null,
      "options":{"reduceOptions":{"calcs":["lastNotNull"],"fields":""},"graphMode":"none","colorMode":"value"},
      "fieldConfig":{"defaults":{"unit":"none","thresholds":{"mode":"absolute","steps":[{"color":"green","value":0},{"color":"yellow","value":1}]}}},
      "targets":[{"expr":"sum(siteboss_alert_count{towerId=~\"$towerId\", level=\"warning\"})"}]},

    {"type":"stat","title":"Last Pull","gridPos":{"x":18,"y":5,"w":6,"h":4},"datasource":null,
      "options":{"reduceOptions":{"calcs":["lastNotNull"],"fields":""},"graphMode":"none","colorMode":"value"},
      "fieldConfig":{"defaults":{"unit":"dateTimeAsIso"}},
      "targets":[{"expr":"siteboss_last_pull_epoch_seconds{towerId=~\"$towerId\"} * 1000"}]},

    {"type":"row","title":"Details","gridPos":{"x":0,"y":9,"w":24,"h":1}},

    {"type":"table","title":"SiteBoss Sensors (latest)","gridPos":{"x":0,"y":10,"w":12,"h":9},"datasource":null,
      "targets":[{"expr":"topk(100, siteboss_sensor_value{towerId=~\"$towerId\"})"}],
      "options":{"showHeader":true}},

    {"type":"table","title":"Simulator Metrics (latest)","gridPos":{"x":12,"y":10,"w":12,"h":9},"datasource":null,
      "targets":[{"expr":"topk(100, simulator_metric_value{towerId=~\"$towerId\"})"}],
      "options":{"showHeader":true}},

    {"type":"row","title":"Trends","gridPos":{"x":0,"y":19,"w":24,"h":1}},

    {"type":"timeseries","title":"SiteBoss Temperatures","gridPos":{"x":0,"y":20,"w":12,"h":8},"datasource":null,
      "fieldConfig":{"defaults":{"decimals":1}},
      "options":{"legend":{"displayMode":"list","placement":"bottom"},"tooltip":{"mode":"single"},"custom":{"lineWidth":2,"showPoints":"never","spanNulls":true}},
      "targets":[{"expr":"siteboss_sensor_value{towerId=~\"$towerId\", name=~\".*Temp.*\"}","legendFormat":"{{name}} ({{units}})"}]},

    {"type":"timeseries","title":"Simulator Temperatures","gridPos":{"x":12,"y":20,"w":12,"h":8},"datasource":null,
      "fieldConfig":{"defaults":{"decimals":1}},
      "options":{"legend":{"displayMode":"list","placement":"bottom"},"tooltip":{"mode":"single"},"custom":{"lineWidth":2,"showPoints":"never","spanNulls":true}},
      "targets":[{"expr":"simulator_metric_value{towerId=~\"$towerId\", name=~\".*temperature.*\"}","legendFormat":"{{name}}"}]}
  ]
}
