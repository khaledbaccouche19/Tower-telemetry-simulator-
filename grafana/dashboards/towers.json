{
  "title": "Towers â€“ SiteBoss & Simulator",
  "uid": "towers-overview",
  "timezone": "browser",
  "schemaVersion": 39,
  "version": 3,
  "editable": true,
  "templating": {
    "list": [
      {
        "type": "query",
        "name": "towerId",
        "label": "Tower",
        "datasource": null,
        "query": "label_values({__name__=~\"siteboss_pull_success_total|telemetry_ingest_saved_total\"}, towerId)",
        "refresh": 1,
        "includeAll": true,
        "allValue": ".*",
        "multi": false
      }
    ]
  },
  "panels": [
    {"type":"stat","title":"SiteBoss Success Rate (5m)","gridPos":{"x":0,"y":0,"w":6,"h":4},"datasource":null,
     "options":{"reduceOptions":{"calcs":["lastNotNull"],"fields":""},"colorMode":"value","graphMode":"area","justifyMode":"center","textMode":"auto"},
     "fieldConfig":{"defaults":{"unit":"percent","decimals":1,"thresholds":{"mode":"absolute","steps":[{"color":"red","value":0},{"color":"yellow","value":90},{"color":"green","value":99}]}}},
     "targets":[{"expr":"(sum(increase(siteboss_pull_success_total{towerId=~\"$towerId\"}[5m])))/(sum(increase(siteboss_pull_success_total{towerId=~\"$towerId\"}[5m]))+sum(increase(siteboss_pull_errors_total{towerId=~\"$towerId\"}[5m])))*100"}]},

    {"type":"stat","title":"SiteBoss Avg Duration (5m)","gridPos":{"x":6,"y":0,"w":6,"h":4},"datasource":null,
     "fieldConfig":{"defaults":{"unit":"s","decimals":2}},
     "targets":[{"expr":"rate(siteboss_pull_duration_seconds_sum{towerId=~\"$towerId\"}[5m]) / rate(siteboss_pull_duration_seconds_count{towerId=~\"$towerId\"}[5m])"}]},

    {"type":"stat","title":"Simulator Saved/min (5m)","gridPos":{"x":12,"y":0,"w":6,"h":4},"datasource":null,
     "fieldConfig":{"defaults":{"unit":"opsmin","decimals":2}},
     "targets":[{"expr":"sum(rate(telemetry_ingest_saved_total{towerId=~\"$towerId\"}[5m]))*60"}]},

    {"type":"stat","title":"Simulator Errors (5m)","gridPos":{"x":18,"y":0,"w":6,"h":4},"datasource":null,
     "fieldConfig":{"defaults":{"unit":"short","thresholds":{"mode":"absolute","steps":[{"color":"green","value":0},{"color":"red","value":1}]}}},
     "targets":[{"expr":"sum(increase(telemetry_ingest_errors_total{towerId=~\"$towerId\"}[5m]))"}]},

    {"type":"stat","title":"SiteBoss Sensor Count","gridPos":{"x":0,"y":4,"w":6,"h":4},"datasource":null,
     "fieldConfig":{"defaults":{"unit":"none","decimals":0}},
     "targets":[{"expr":"sum(siteboss_sensor_count{towerId=~\"$towerId\"})"}]},

    {"type":"stat","title":"SiteBoss Device Time","gridPos":{"x":6,"y":4,"w":6,"h":4},"datasource":null,
     "fieldConfig":{"defaults":{"unit":"dateTimeAsIso"}},
     "targets":[{"expr":"siteboss_device_time_epoch_seconds{towerId=~\"$towerId\"} * 1000"}]},

    {"type":"stat","title":"Last Pull","gridPos":{"x":12,"y":4,"w":6,"h":4},"datasource":null,
     "fieldConfig":{"defaults":{"unit":"dateTimeAsIso"}},
     "targets":[{"expr":"siteboss_last_pull_epoch_seconds{towerId=~\"$towerId\"} * 1000"}]},

    {"type":"stat","title":"SiteBoss Device","gridPos":{"x":18,"y":4,"w":6,"h":4},"datasource":null,
     "options":{"textMode":"name"},
     "targets":[{"expr":"siteboss_unit_info{towerId=~\"$towerId\"}","legendFormat":"{{siteName}} ({{serial}})"}]},

    {"type":"timeseries","title":"SiteBoss Pull Duration (avg over 5m)","gridPos":{"x":0,"y":8,"w":12,"h":8},"datasource":null,
     "fieldConfig":{"defaults":{"unit":"s","decimals":2}},
     "targets":[{"expr":"rate(siteboss_pull_duration_seconds_sum{towerId=~\"$towerId\"}[5m]) / rate(siteboss_pull_duration_seconds_count{towerId=~\"$towerId\"}[5m])"}]},

    {"type":"timeseries","title":"SiteBoss Success vs Errors (5m)","gridPos":{"x":12,"y":8,"w":12,"h":8},"datasource":null,
     "options":{"legend":{"displayMode":"list","placement":"bottom"},"tooltip":{"mode":"single"}},
     "targets":[{"expr":"sum(increase(siteboss_pull_success_total{towerId=~\"$towerId\"}[5m]))","legendFormat":"success"},
                {"expr":"sum(increase(siteboss_pull_errors_total{towerId=~\"$towerId\"}[5m]))","legendFormat":"errors"}]},

    {"type":"timeseries","title":"Simulator Saved per Minute","gridPos":{"x":0,"y":16,"w":24,"h":8},"datasource":null,
     "fieldConfig":{"defaults":{"unit":"opsmin","decimals":2}},
     "targets":[{"expr":"sum(rate(telemetry_ingest_saved_total{towerId=~\"$towerId\"}[5m]))*60","legendFormat":"saved/min"}]}
  ]
}
